---
title: 规范 · C++ 编程
categories: [工作]
comments: true
---

​	在C++开发领域，编码规范是保证代码质量、可读性和可维护性的基石。Google作为技术领域的领航者，其内部使用的C++编码规范（Google C++ Style Guide）更是被众多开发者奉为圭臬。本文将详细解析Google C++编码规范中的48条最关键准则，帮助开发者深入理解并遵循这些最佳实践，从而提升代码质量。

#### 一、文件结构与命名

1. 头文件保护：所有头文件应使用`#ifndef`、`#define`和`#endif`宏来防止多重包含。命名格式通常为`PROJECT_PATH_FILENAME_H_`。
2. 文件命名：文件名应全部小写，使用下划线分隔单词，如`my_class.h`。
3. 文件结构：每个`.cc`文件应有一个对应的`.h`文件。头文件包含类和函数的声明，源文件包含实现。
4. 命名空间：遵守命名空间命名规则，使用项目路径作为命名空间名是一个不错的选择。在命名空间的最后注释出命名空间的名字。
5. 避免using声明：不要使用`using`引入整个命名空间的标识符号，以避免命名空间污染。

#### 二、作用域与变量

1. 局部变量：使用小写字母和下划线命名局部变量，如`my_variable`。
2. 类成员变量：类成员变量以下划线结尾，如`my_variable_`，以区分局部变量。
3. 静态变量：静态变量和全局变量使用`g_`或`s_`前缀（根据上下文选择），如`g_config`或`s_counter`。
4. 常量命名：常量使用大写字母和下划线，如`kMaxValue`。对于声明为`constexpr`或`const`的变量，命名时以`k`开头。
5. 函数参数：函数参数命名应与局部变量一致，使用小写字母和下划线。

#### 三、类与结构体

1. 类命名：类名应使用驼峰命名法，首字母大写，如`MyClass`。
2. 结构体命名：仅当只有数据成员时使用`struct`，其他情况使用`class`。
3. 数据成员：将所有数据成员声明为`private`，除非是`static const`类型成员。
4. 构造函数：构造函数尽量使用`explicit`关键字修饰，以避免隐式类型转换。
5. 析构函数：析构函数应尽量简单，不进行复杂的逻辑操作。
6. 拷贝构造函数与赋值运算符：为避免拷贝构造函数和赋值操作的滥用，可将其声明为`private`且无需实现。
7. 继承：尽量使用组合（composition）而不是继承（inheritance）。如果必须使用继承，确保基类有一个虚析构函数。
8. 访问器与修改器：通过访问器（getter）和修改器（setter）访问私有成员变量。

#### 四、函数

1. 函数命名：函数名应使用驼峰命名法，如`CalculateSum`。对于取值和设值函数，要求与变量名匹配，如`my_exciting_member_variable()`和`set_my_exciting_member_variable()`。
2. 函数长度：函数应尽量短小，通常不超过40行。如果函数过长，考虑将其拆分成多个函数。
3. 参数传递：对于简单的数据类型（如`int`、`char`），按值传递；对于复杂的数据类型（如对象），使用常量引用传递（`const T&`）。
4. 虚函数：虚函数中不允许使用缺省参数，因为缺省参数的解析是在编译期间完成的，而虚函数的调用是在运行时确定的，两者之间的冲突可能导致意外的结果。
5. const修饰：尽可能多地使用`const`进行参数、返回值和成员函数的限制。

#### 五、注释与文档

1. 文件头部注释：每个文件应包含文件头部注释，描述文件的内容和功能。
2. 函数注释：每个函数应包含注释，描述函数的功能、参数和返回值。
3. 行内注释：使用行内注释解释复杂或重要的代码逻辑。
4. 注释风格：使用`//`或`/* */`进行注释，保持风格统一。

#### 六、代码格式与风格

1. 缩进：使用两个空格进行缩进，不使用制表符（tab）。
2. 行宽：每行代码不超过80个字符（也有说法是不超过120个字符，具体根据团队约定）。
3. 空行：在函数、类和方法之间使用空行分隔，以提高代码的可读性。
4. 命名一致性：在编写一个子模块或派生类时，要遵循其基类或整体模块的命名风格。
5. 避免重名：避免在不同级别的作用域中重名，尽管作用域不同不会发生语法错误，但容易误解。
6. 避免相似命名：不要出现仅靠大小写区分的相似标识符。
7. 避免数字编号：除非逻辑上需要编号，否则避免在命名中使用数字编号。

#### 七、特定编码实践

1. 智能指针：尽量使用智能指针（如`std::unique_ptr`和`std::shared_ptr`）而不是原始指针，以避免内存泄漏和悬挂指针。

2. 异常处理：尽量避免使用异常进行错误处理，推荐使用返回值或状态码来表示错误。

3. 线程安全：在多线程环境中，确保共享数据的访问是线程安全的，使用`std::mutex`、`std::lock_guard`等同步机制。

4. 单元测试：为每个类和函数编写单元测试，确保代码的正确性和稳定性。使用Google Test框架进行单元测试。

5. 避免多重继承：多重继承可能会降低代码的可读性和可维护性，应尽量避免使用。

6. 避免宏定义：宏定义可能会导致代码难以理解和维护，应尽量避免使用。

7. 避免可变参数模板：可变参数模板可能会增加代码的复杂性，应谨慎使用。

8. 枚举命名：枚举的命名应与常量一致，使用大写字母和下划线，如`kEnumName`。

9. 宏命名：宏的命名应全部大写，使用下划线分隔单词，如`MY_MACRO_THAT_SCARES_SMALL_CHILDREN`。

10. 类型命名：所有类型命名（类、结构体、类型定义、枚举、类型模板参数）均使用相同约定，即以大写字母开始，每个单词首字母均大写，不包含下划线。

11. 代码审查：定期进行代码审查，确保代码符合编码规范，及时发现并修复问题。

12. 持续集成：将编码规范检查纳入持续集成流程，确保每次提交的代码都符合规范。

13. 工具辅助：使用工具（如`cpplint`）检查代码风格错误，提高代码质量。

14. 文档更新：随着项目的发展，及时更新编码规范和文档，确保团队成员始终遵循最新的最佳实践。

    

​	Google的C++编码规范是一套详尽而实用的指南，它涵盖了文件结构、命名约定、作用域管理、类与结构体设计、函数编写、注释与文档、代码格式与风格以及特定编码实践等多个方面。遵循这些规范，不仅有助于提高代码的可读性和可维护性，还能减少团队协作中的沟通成本，提升整体开发效率。作为C++开发者，深入理解并实践这些规范，将是我们不断提升专业技能、追求卓越代码质量的重要一步。
