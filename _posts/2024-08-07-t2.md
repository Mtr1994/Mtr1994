---
title: 流程 · 生成桌面图标文件
categories: [工作]
comments: true
---

#### 一、下载软件

​	使用 `IcoFX` 软件生成 `Windows` 下的 `ICON` 文件，地址：https://www.icofx.ro/

#### 二、生成图标

​	打开 `IcoFX` 软件，打开准备好的 `256x256` 的 `PNG` 或者 `JPG` 图像，选择 `Open as an image` 选项；打开图像后，通过 `Image` 菜单栏下的 `Create Windows Icon From Image` 子菜单，弹窗中先点击 `Recommmended` 选项，然后点击 `OK` 按钮，生成的图像会在软件中展示。

​	导出文件为 `ico` 文件；通过 `File` 菜单下的 `Save as` 子菜单，另存为 `Windows Icon (*.ico)` 文件。

#### 三、使用图标

​	在 `Qt` 项目的 `pro` 文件中加入代码

       ```shell
       // 主要实际 ICON 文件的路径
       RC_ICONS = $$PWD/Resource/icon/icon.ico
       ```

#### 四、注意事项

​	在 `Windows` 下，有时候程序的缩略图不会及时更新，会导致更新了 `ICON` 之后，桌面快捷方式等图像不会立即改变，需要强制更新系统的缩略图，可以使用以下脚本来进行更新

```bat
rem 关闭Windows外壳程序explorer

taskkill /f /im explorer.exe

rem 清理系统图标缓存数据库

attrib -h -s -r "%userprofile%\AppData\Local\IconCache.db"

del /f "%userprofile%\AppData\Local\IconCache.db"

attrib /s /d -h -s -r "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\*"

del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_32.db"
del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_96.db"
del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_102.db"
del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_256.db"
del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_1024.db"
del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_idx.db"
del /f "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\thumbcache_sr.db"

rem 清理 系统托盘记忆的图标

echo y|reg delete "HKEY_CLASSES_ROOT\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify" /v IconStreams
echo y|reg delete "HKEY_CLASSES_ROOT\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify" /v PastIconsStream

rem 重启Windows外壳程序explorer

start explorer
```

> 在 `Windows` 下新建一个 `.bat` 文件，输入上述内容，双击运行即可。
